package models

import "time"

// ScanResults represents the top-level structure of the results.json file
type ScanResults struct {
	Vulnerabilities []Vulnerability `json:"vulns"`
}

// Vulnerability represents a security vulnerability entry
type Vulnerability struct {
	ID            string            `json:"id"`
	Summary       string            `json:"summary"`
	Details       string            `json:"details"`
	Aliases       []string          `json:"aliases"`
	Modified      time.Time         `json:"modified"`
	Published     time.Time         `json:"published"`
	DBSpecific    DatabaseSpecific  `json:"database_specific"`
	References    []Reference       `json:"references"`
	Affected      []AffectedPackage `json:"affected"`
	SchemaVersion string            `json:"schema_version"`
	Severity      []SeverityRating  `json:"severity,omitempty"`
}

// DatabaseSpecific contains database-specific information about the vulnerability
type DatabaseSpecific struct {
	GithubReviewedAt time.Time `json:"github_reviewed_at"`
	GithubReviewed   bool      `json:"github_reviewed"`
	Severity         string    `json:"severity"`
	CWEIDs           []string  `json:"cwe_ids"`
	NVDPublishedAt   time.Time `json:"nvd_published_at"`
}

// Reference contains URLs and reference information about the vulnerability
type Reference struct {
	Type string `json:"type"`
	URL  string `json:"url"`
}

// AffectedPackage contains information about a package affected by the vulnerability
type AffectedPackage struct {
	Package          Package                 `json:"package"`
	Ranges           []Range                 `json:"ranges"`
	Versions         []string                `json:"versions,omitempty"`
	DatabaseSpecific PackageDatabaseSpecific `json:"database_specific,omitempty"`
}

// Package contains information about a specific software package
type Package struct {
	Name      string `json:"name"`
	Ecosystem string `json:"ecosystem"`
	PURL      string `json:"purl"`
}

// Range defines version ranges affected by the vulnerability
type Range struct {
	Type   string  `json:"type"`
	Events []Event `json:"events"`
}

// Event represents a version event like when a vulnerability was introduced or fixed
type Event struct {
	Introduced string `json:"introduced,omitempty"`
	Fixed      string `json:"fixed,omitempty"`
}

// PackageDatabaseSpecific contains database-specific information about an affected package
type PackageDatabaseSpecific struct {
	Source                        string `json:"source"`
	LastKnownAffectedVersionRange string `json:"last_known_affected_version_range,omitempty"`
}

// SeverityRating represents the severity rating information
type SeverityRating struct {
	Type  string `json:"type"`
	Score string `json:"score"`
}
